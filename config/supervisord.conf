[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
loglevel=info

# =============================================================================
# Xvfb - Virtual Framebuffer (must start first)
# =============================================================================
[program:xvfb]
command=/usr/bin/Xvfb %(ENV_DISPLAY)s -screen 0 %(ENV_RESOLUTION)sx24 +extension GLX +render -noreset
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/xvfb.log
stderr_logfile=/var/log/supervisor/xvfb_err.log

# =============================================================================
# Openbox - Lightweight Window Manager
# =============================================================================
[program:openbox]
command=/usr/bin/openbox-session
environment=DISPLAY="%(ENV_DISPLAY)s"
autostart=true
autorestart=true
priority=20
startsecs=3
stdout_logfile=/var/log/supervisor/openbox.log
stderr_logfile=/var/log/supervisor/openbox_err.log

# =============================================================================
# TurboVNC Server - GPU-accelerated VNC
# Performance settings:
#   -quality 80: Good quality vs bandwidth tradeoff
#   -compress tight: Best for LAN/fast connections
#   -websocket: Direct websocket support (faster than websockify)
# =============================================================================
[program:turbovnc]
command=/opt/TurboVNC/bin/vncserver %(ENV_DISPLAY)s -fg -securitytypes none -noxstartup
environment=DISPLAY="%(ENV_DISPLAY)s",VGL_DISPLAY="%(ENV_VGL_DISPLAY)s"
autostart=true
autorestart=true
priority=30
startsecs=5
stdout_logfile=/var/log/supervisor/turbovnc.log
stderr_logfile=/var/log/supervisor/turbovnc_err.log

# =============================================================================
# noVNC - Web-based VNC client via websockify
# Low-latency settings for remote demos
# =============================================================================
[program:novnc]
command=websockify --web=/opt/noVNC %(ENV_NOVNC_PORT)s localhost:5901
autostart=true
autorestart=true
priority=40
startsecs=5
stdout_logfile=/var/log/supervisor/novnc.log
stderr_logfile=/var/log/supervisor/novnc_err.log

# =============================================================================
# Reachy Mini Daemon - MuJoCo Simulation
# Scene is configurable via REACHY_SCENE env var (empty|minimal)
# =============================================================================
[program:reachy-daemon]
command=/bin/bash -c "sleep 8 && vglrun reachy-mini-daemon --sim --scene %(ENV_REACHY_SCENE)s"
environment=DISPLAY="%(ENV_DISPLAY)s",VGL_DISPLAY="%(ENV_VGL_DISPLAY)s",__GLX_VENDOR_LIBRARY_NAME="nvidia"
autostart=true
autorestart=true
priority=50
startsecs=10
stdout_logfile=/var/log/supervisor/reachy-daemon.log
stderr_logfile=/var/log/supervisor/reachy-daemon_err.log

# =============================================================================
# Jupyter Lab - Interactive Development
# =============================================================================
[program:jupyter]
command=jupyter lab --ip=0.0.0.0 --port=%(ENV_JUPYTER_PORT)s --no-browser --allow-root
directory=/workspace
environment=DISPLAY="%(ENV_DISPLAY)s"
autostart=true
autorestart=true
priority=60
startsecs=5
stdout_logfile=/var/log/supervisor/jupyter.log
stderr_logfile=/var/log/supervisor/jupyter_err.log

